<!DOCTYPE html>
<html>

<head>
	<!-- <meta http-equiv="refresh" content="60" /> -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Dia Dia é meu</title>
	<link rel="shortcut icon"
		HREF="https://static.wixstatic.com/media/7bddc8_b0a20b809f8647898991ef927d5203d8%7Emv2.png/v1/fill/w_192%2Ch_192%2Clg_1%2Cusm_0.66_1.00_0.01/7bddc8_b0a20b809f8647898991ef927d5203d8%7Emv2.png">

	<style>
		* {
			box-sizing: border-box;
			margin: auto;
		}

		body {
			font-family: Verdana, sans-serif;
			overflow: hidden;
			background-color: #1E22A8;
		}

		.mySlides {
			display: none;
		}

		#galeria {
			position: relative;
			width: 100vw;
			height: 100vh;
			text-align: center;
			justify-content: center;
			margin: auto;
		}

		#galeria img,
		iframe {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			border: none;
			width: 100%;
			height: 100%;
			max-width: 98%;
			max-height: 98%;
			object-fit: contain;
			/* Pode manter, se quiser, mas pode remover para TVs mais antigas */
		}

		.text {
			color: #f2f2f2;
			font-size: 15px;
			padding: 8px 12px;
			position: absolute;
			bottom: 8px;
			height: 100%;
			width: 100%;
			text-align: center;
		}

		.numbertext {
			color: #f2f2f2;
			font-size: 12px;
			padding: 8px 12px;
			position: absolute;
			top: 0;
		}

		.dot {
			height: 15px;
			width: 15px;
			margin: 0 2px;
			background-color: #bbb;
			border-radius: 50%;
			display: inline-block;
			transition: background-color 0.6s ease;
		}

		.active {
			background-color: #717171;
			height: 100%;
		}

		#barra-contagem {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 8px;
			background-color: rgba(0, 0, 0, 0.1);
			z-index: 9999;
			overflow: hidden;
		}

		#barra {
			height: 100%;
			width: 100%;
			background-color: #4caf50;
		}

		#spanRelogio {
			position: fixed;
			bottom: 10px;
			left: 10px;
			padding: 8px 12px;
			background-color: rgba(0, 0, 0, 0.4);
			color: rgba(255, 255, 255, 0.4);
			font-size: 14px;
			border-radius: 4px;
			z-index: 9999;
		}
	</style>
</head>

<body>

	<span id="spanRelogio"></span>
	<div id="galeria">
		<span>Erro, tentanto novamente em 5 segundos...</span>

		<!-- <img class="mySlides ajuste" alt=""> -->
		<!-- <img class="mySlides ajuste" src="./src/2.png" alt="">
		<img class="mySlides ajuste" src="./src/3.png" alt=""> -->
	</div>

	<div id="barra-contagem">
		<div id="barra"></div>
	</div>

	<script language="javaScript">
		window.onblur = function () { window.onfocus = function () { location.reload(true) } };

		var min, seg;		//min = 10;		seg = 1		
		const data = new Date(); // momento atual 
		var seg = 60 - data.getSeconds()
		var min = data.getMinutes() > 30 ? 60 - data.getMinutes() : 30 - data.getMinutes()

		function relogio() {
			if ((min > 0) || (seg > 0)) {
				if (seg == 0) {
					seg = 59;
					min = min - 1
				}
				else {
					seg = seg - 1;
				}
				if (min.toString().length == 1) {
					min = "0" + min;
				}
				if (seg.toString().length == 1) {
					seg = "0" + seg;
				}
				document.getElementById('spanRelogio').innerHTML = "Próxima Atualização em: " + min + ":" + seg;
				setTimeout('relogio()', 1000);
			}
			else {
				document.getElementById('spanRelogio').innerHTML = "00:00";
				location.href = location.href.split('?')[0] + '?nocache=' + new Date().getTime();

			}
		}	
	</script>

	<script>
		function iniciarContagem(duracao) {
			var barra = document.getElementById("barra");
			var tempoRestante = duracao;
			var intervalo = 50; // Atualizar a cada 50ms (ajustável)
			var larguraInicial = 100;

			clearInterval(barra.timer); // Se houver animação anterior, para ela

			barra.style.width = "100%";

			barra.timer = setInterval(function () {
				tempoRestante -= intervalo;
				var progresso = Math.max(0, tempoRestante / duracao);
				barra.style.width = (progresso * larguraInicial) + "%";

				if (tempoRestante <= 0) {
					clearInterval(barra.timer);
					barra.style.width = "0%";
				}
			}, intervalo);
		}
	</script>

	<script>
		async function LoadImg(params) {
			// https://drive.google.com/file/d/1tG9DNU-exAHVYaxfVlRnkq2FUxWwkhb0/view?usp=drive_link
			const urlJSON = "https://intcicopal.github.io/diadia/diadia.json";
			// const urlJSON = "https://drive.google.com/file/d/1tG9DNU-exAHVYaxfVlRnkq2FUxWwkhb0/view?usp=drive_link";

			await fetch(urlJSON)
				.then(response => response.json())
				.then(data => {
					const galeria = document.getElementById("galeria");
					var indexTT = 0;

					// Processar imagens
					if (data.imagens && Array.isArray(data.imagens)) {
						data.imagens.forEach(function (item, index) {
							const img = document.createElement('img');
							img.className = "mySlides";
							img.src = `https://intcicopal.github.io/diadia/src/${item.nome}`;
							galeria.appendChild(img);
							// console.log(`Imagem ${indexTT += index}:`, item.nome, "Tempo:", item.tempo);

							tempopp[indexTT++] = item.tempo * 1000;
						});
					}

					// Processar links
					if (data.links && Array.isArray(data.links)) {
						data.links.forEach(function (item, index) {

							const iframe = document.createElement('iframe');
							iframe.className = "mySlides";
							iframe.allowFullScreen = "true"
							iframe.src = `https://app.powerbi.com/reportEmbed?reportId=${item.reportId}&autoAuth=true&ctid=${item.ctid}&pageName=${item.pageName}&navContentPaneEnabled=false&filterPaneEnabled=false&actionBarEnabled=false`;
							galeria.appendChild(iframe);
							// console.log(`Link ${indexTT += index}:`, item.url, "Tempo:", item.tempo);

							tempopp[indexTT++] = item.tempo * 1000;
						});
					}

					// itens.forEach(function (item, index) {
					// 	if (item.tipo === "imagem") {
					// 		const img = document.createElement('img');
					// 		img.className = "mySlides ajuste"
					// 		img.src = `https://intcicopal.github.io/diadia/src/${item.nome}`
					// 		galeria.appendChild(img);
					// 	}

					// 	if (item.tipo === "link") {
					// 		const iframe = document.createElement('iframe');
					// 		iframe.src = `https://app.powerbi.com/reportEmbed?reportId=ef3f9bae-1219-471b-9507-61b4a708a6b3&autoAuth=true&ctid=7237e24f-5c57-4444-a72b-80ca44c58630&pageName=9de9b7dc93dbded12a1b`;
					// 		galeria.appendChild(iframe);
					// 	}


					// 	tempopp[index] = item.tempo * 1000;

					// 	// Exemplo: tipos futuros como texto, PDF, etc...
					// });
					showSlides();
				})
				.catch(error => {
					console.error('Erro ao carregar JSON:', error);
					console.log('Tentando novamente em 5 segundos...');
					setTimeout(() => {
						location.href = location.href.split('?')[0] + '?nocache=' + new Date().getTime();
					}, 5000);
				});
		}

	</script>

	<script>

		LoadImg()

		var tempopp = new Array;

		var slideIndex = 0;

		relogio();

		function showSlides() {
			var i;
			var slides = document.getElementsByClassName("mySlides");

			for (i = 0; i < slides.length; i++) { slides[i].style.display = "none"; } if (slideIndex >= slides.length) {
				slideIndex = 0;
			}

			slides[slideIndex].style.display = "block";

			setTimeout(showSlides, tempopp[slideIndex]);
			iniciarContagem(tempopp[slideIndex])
			slideIndex++;
		}
	</script>


</body>

</html>